/auth/signup:
  post:
    tags:
      - Authentication
    summary: Register a new user
    description: Create a new user account with email and password
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UserSignup'
    responses:
      201:
        description: User created successfully
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserResponse'
      400:
        $ref: '#/components/responses/ValidationError'
      409:
        description: User already exists
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "User already exists"
      500:
        $ref: '#/components/responses/ServerError'

/auth/signin:
  post:
    tags:
      - Authentication
    summary: Sign in user
    description: Authenticate user with email and password
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UserLogin'
    responses:
      200:
        description: Login successful
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthResponse'
      400:
        $ref: '#/components/responses/ValidationError'
      401:
        description: Invalid credentials
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "Invalid credentials"
      500:
        $ref: '#/components/responses/ServerError'

/auth/signout:
  post:
    tags:
      - Authentication
    summary: Sign out user
    description: Sign out the current user and invalidate session
    security:
      - sessionAuth: []
    responses:
      200:
        description: Logout successful
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: "Logged out successfully"
      401:
        $ref: '#/components/responses/UnauthorizedError'
      500:
        $ref: '#/components/responses/ServerError'

/auth/verify-email:
  post:
    tags:
      - Authentication
    summary: Send email verification
    description: Send verification email to user
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EmailVerificationRequest'
    responses:
      200:
        description: Verification email sent
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: "Verification email sent"
      400:
        $ref: '#/components/responses/ValidationError'
      500:
        $ref: '#/components/responses/ServerError'

/auth/verify-token:
  post:
    tags:
      - Authentication
    summary: Verify email token
    description: Verify email using verification token
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/TokenVerificationRequest'
    responses:
      200:
        description: Email verified successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: "Email verified successfully"
      400:
        $ref: '#/components/responses/ValidationError'
      401:
        description: Invalid or expired token
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "Invalid or expired token"
      500:
        $ref: '#/components/responses/ServerError'

/auth/check-admin-role:
  get:
    tags:
      - Authentication
      - RBAC
    summary: Check if user has admin role
    description: |
      Internal endpoint used by middleware to verify if a user has admin-level roles.
      Checks against SUPER_ADMIN, ADMIN, MODERATOR, and INSTRUCTOR roles.
      
      **Note:** This endpoint is primarily used by Edge Runtime middleware which cannot
      perform direct database queries. It maps Supabase user IDs to local database IDs.
    parameters:
      - name: x-supabase-user-id
        in: header
        required: true
        schema:
          type: string
          format: uuid
        description: Supabase Auth user ID
    responses:
      200:
        description: Role check result
        content:
          application/json:
            schema:
              type: object
              properties:
                hasAdminRole:
                  type: boolean
                  description: Whether the user has any admin-level role
                roles:
                  type: array
                  items:
                    type: string
                  description: List of user's active role names
                  example: ["SUPER_ADMIN", "INSTRUCTOR"]
                localUserId:
                  type: string
                  format: uuid
                  description: User ID in the local database
      400:
        description: Missing user ID
        content:
          application/json:
            schema:
              type: object
              properties:
                hasAdminRole:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "No user ID provided"
      404:
        description: User not found in local database
        content:
          application/json:
            schema:
              type: object
              properties:
                hasAdminRole:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "User not found"
      500:
        $ref: '#/components/responses/ServerError'

/auth/get-local-user-id:
  get:
    tags:
      - Authentication
      - RBAC
    summary: Get local database user ID from Supabase ID
    description: |
      Maps a Supabase Auth user ID to the corresponding local database user ID.
      This is necessary because Supabase Auth uses its own user IDs which differ
      from the local database user IDs used for RBAC.
    security:
      - sessionAuth: []
    parameters:
      - name: supabaseUserId
        in: query
        required: true
        schema:
          type: string
          format: uuid
        description: Supabase Auth user ID to look up
    responses:
      200:
        description: Local user ID found
        content:
          application/json:
            schema:
              type: object
              properties:
                localUserId:
                  type: string
                  format: uuid
                  description: User ID in the local database
      400:
        description: Missing Supabase user ID
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "supabaseUserId is required"
      404:
        description: User not found
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "User not found"
      500:
        $ref: '#/components/responses/ServerError'
