import { useEffect, useState } from 'react';

export function SwaggerUI() {
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    
    if (typeof window === 'undefined') return;
    
    // Dynamically load Swagger UI scripts and styles
    const loadSwaggerUI = async () => {
      // Load CSS
      const cssLink = document.createElement('link');
      cssLink.rel = 'stylesheet';
      cssLink.href = 'https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui.css';
      document.head.appendChild(cssLink);

      // Load Scripts
      const bundleScript = document.createElement('script');
      bundleScript.src = 'https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-bundle.js';
      document.head.appendChild(bundleScript);

      const presetScript = document.createElement('script');
      presetScript.src = 'https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-standalone-preset.js';
      document.head.appendChild(presetScript);

      // Wait for scripts to load
      await new Promise((resolve) => {
        presetScript.onload = resolve;
      });

      // Initialize Swagger UI
      const origin = window.location.origin;
      
      // @ts-ignore
      const ui = SwaggerUIBundle({
        url: `${origin}/api/swagger`,
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          // @ts-ignore
          SwaggerUIBundle.presets.apis,
          // @ts-ignore
          SwaggerUIStandalonePreset
        ],
        plugins: [
          // @ts-ignore
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout",
        tryItOutEnabled: true,
        supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
        docExpansion: "list",
        defaultModelsExpandDepth: 1,
        defaultModelExpandDepth: 1,
        displayRequestDuration: true,
        filter: true,
        persistAuthorization: true,
        onComplete: function() {
          console.log('Swagger UI loaded successfully');
        }
      });
      
      // @ts-ignore
      window.ui = ui;
    };

    loadSwaggerUI();
  }, []);

  if (!mounted) {
    return (
      <div className="flex justify-center items-center p-8">
        <div className="text-lg">Loading API Documentation...</div>
      </div>
    );
  }

  return (
    <div className="swagger-ui-container">
      <div id="swagger-ui" />
      <style jsx global>{`
        .swagger-ui-container {
          font-family: inherit !important;
        }
        
        .swagger-ui .topbar {
          display: none !important;
        }
        
        .swagger-ui .info {
          margin: 20px 0 !important;
        }
        
        .swagger-ui .info .title {
          font-size: 1.5rem !important;
          color: inherit !important;
        }
        
        .swagger-ui .info .description {
          color: inherit !important;
          opacity: 0.8;
        }
        
        .swagger-ui .scheme-container {
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 8px !important;
          padding: 10px !important;
          margin-bottom: 20px !important;
          opacity: 0.9;
        }
        
        .swagger-ui .opblock {
          border: 1px solid currentColor !important;
          border-radius: 8px !important;
          margin-bottom: 10px !important;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
          background: transparent !important;
          opacity: 0.95;
        }
        
        .swagger-ui .btn.try-out__btn {
          background: #3b82f6 !important;
          border-color: #3b82f6 !important;
          color: white !important;
          font-weight: 500 !important;
        }
        
        .swagger-ui .btn.try-out__btn:hover {
          background: #2563eb !important;
          border-color: #2563eb !important;
        }
        
        .swagger-ui .btn.execute {
          background: #10b981 !important;
          border-color: #10b981 !important;
          color: white !important;
          font-weight: 500 !important;
        }
        
        .swagger-ui .btn.execute:hover {
          background: #059669 !important;
          border-color: #059669 !important;
        }
        
        .swagger-ui .btn.cancel {
          background: #ef4444 !important;
          border-color: #ef4444 !important;
          color: white !important;
          font-weight: 500 !important;
        }
        
        .swagger-ui .btn.cancel:hover {
          background: #dc2626 !important;
          border-color: #dc2626 !important;
        }
        
        .swagger-ui input[type="text"],
        .swagger-ui input[type="password"],
        .swagger-ui input[type="email"],
        .swagger-ui input[type="number"],
        .swagger-ui textarea,
        .swagger-ui select {
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 6px !important;
          color: inherit !important;
          opacity: 0.9;
          padding: 8px !important;
        }
        
        .swagger-ui input[type="text"]:focus,
        .swagger-ui input[type="password"]:focus,
        .swagger-ui input[type="email"]:focus,
        .swagger-ui input[type="number"]:focus,
        .swagger-ui textarea:focus,
        .swagger-ui select:focus {
          border-color: #3b82f6 !important;
          box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
          outline: none !important;
        }
        
        .swagger-ui .parameters-container {
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 8px !important;
          opacity: 0.9;
        }
        
        .swagger-ui .responses-wrapper {
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 8px !important;
          opacity: 0.9;
        }
        
        .swagger-ui .execute-wrapper {
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 8px !important;
          opacity: 0.9;
        }
        
        .swagger-ui .highlight-code {
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 6px !important;
          opacity: 0.9;
        }
        
        .swagger-ui .model {
          font-family: 'Monaco', 'Consolas', 'Courier New', monospace !important;
          background: transparent !important;
          border: 1px solid currentColor !important;
          border-radius: 6px !important;
          opacity: 0.9;
        }
        
        /* Method colors */
        .swagger-ui .opblock.opblock-post {
          border-color: #3b82f6 !important;
          background: rgba(59, 130, 246, 0.05) !important;
        }
        
        .swagger-ui .opblock.opblock-post .opblock-summary-method {
          background: #3b82f6 !important;
        }
        
        .swagger-ui .opblock.opblock-get {
          border-color: #10b981 !important;
          background: rgba(16, 185, 129, 0.05) !important;
        }
        
        .swagger-ui .opblock.opblock-get .opblock-summary-method {
          background: #10b981 !important;
        }
        
        .swagger-ui .opblock.opblock-delete {
          border-color: #ef4444 !important;
          background: rgba(239, 68, 68, 0.05) !important;
        }
        
        .swagger-ui .opblock.opblock-delete .opblock-summary-method {
          background: #ef4444 !important;
        }
        
        .swagger-ui .opblock.opblock-put {
          border-color: #f59e0b !important;
          background: rgba(245, 158, 11, 0.05) !important;
        }
        
        .swagger-ui .opblock.opblock-put .opblock-summary-method {
          background: #f59e0b !important;
        }
        
        .swagger-ui .opblock.opblock-patch {
          border-color: #8b5cf6 !important;
          background: rgba(139, 92, 246, 0.05) !important;
        }
        
        .swagger-ui .opblock.opblock-patch .opblock-summary-method {
          background: #8b5cf6 !important;
        }
        
        /* Dark mode adjustments */
        @media (prefers-color-scheme: dark) {
          .swagger-ui .opblock.opblock-post {
            background: rgba(59, 130, 246, 0.1) !important;
          }
          
          .swagger-ui .opblock.opblock-get {
            background: rgba(16, 185, 129, 0.1) !important;
          }
          
          .swagger-ui .opblock.opblock-delete {
            background: rgba(239, 68, 68, 0.1) !important;
          }
          
          .swagger-ui .opblock.opblock-put {
            background: rgba(245, 158, 11, 0.1) !important;
          }
          
          .swagger-ui .opblock.opblock-patch {
            background: rgba(139, 92, 246, 0.1) !important;
          }
        }
      `}</style>
    </div>
  );
}

# ü•ã Karate Dojo API Documentation

Interactive API documentation with live testing capabilities. Click "Try it out" on any endpoint to test it.

## Quick Links

- [üì• Download OpenAPI JSON](/api/swagger)
- [‚ÑπÔ∏è API Info](/api/info)
- [üè† Back to App](/)

## How to Use

1. **Expand any endpoint** by clicking on it
2. **Click "Try it out"** to enable testing
3. **Fill in parameters** if required
4. **Click "Execute"** to send the request
5. **View the response** below

## Interactive API Explorer

<SwaggerUI />

## API Overview

The Karate Dojo API provides comprehensive endpoints for:

- **Authentication** - User login, registration, and session management
- **User Management** - User profiles, preferences, and data
- **Role-Based Access Control** - Permissions, roles, and access management
- **Dashboard** - User dashboard data and statistics
- **System** - Health checks, info, and system utilities

## Response Formats

All API responses follow consistent patterns:

- **Success**: `200 OK` with data payload
- **Client Error**: `4xx` with error details
- **Server Error**: `5xx` with error message

## Authentication

Most endpoints require authentication via:

- **Session cookies** for web application
- **API tokens** for programmatic access
- **OAuth providers** for third-party integration

## Rate Limiting

API requests are rate-limited to ensure fair usage:

- **Authenticated users**: 1000 requests per hour
- **Anonymous users**: 100 requests per hour
- **Burst limit**: 50 requests per minute
