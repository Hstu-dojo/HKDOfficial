// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

// run `npx prisma generate` to generate ERD diagram
generator markdown {
  provider = "prisma-markdown"
  output   = "../public/erd/ERD.md"
  title    = "HSTU Karate Dojo"
}


// create enumeration of roles
enum Roletype {
  ADMIN
  MODERATOR
  INSTRUCTOR
  MEMBER
  GUEST
}
enum IdentityType {
  NID
  BIRTH_CERTIFICATE
  PASSPORT
  DRIVING_LICENSE
}
enum ProviderType {
  Google
  GitHub
}


model Account {
  id                 Int  @id @default(sequence())
  userId             String  @unique
  name               String
  name_bangla        String
  father_name        String
  image              String
  avatar             String?
  bio                String?
  sex                String
  dob                DateTime
  phone              String
  address            String
  city               String
  state              String
  country            String
  postalCode         String
  age                Int
  bloodGroup         String
  height             Float
  weight             Float
  occupation         String
  identity_type      IdentityType
  identity_number    String
  identity_image     String?
  institute          String
  faculty            String?
  department         String?
  session            String?
  signature_image    String


  
  user User @relation(fields: [userId], references: [id])
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  @@map("account")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String @unique
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@map("session")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  emailVerified Boolean?  @default(false)
  password      String
  userName      String    @unique
  userAvatar    String
  account       Account?
  sessions      Session[]
  providers     Provider[]
  role          UserRole[]
  defaultRole   Roletype  @default(GUEST)
  verificationToken VerificationToken[]
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  @@map("user")
  
}

model Provider {
  id                 String   @id @default(uuid())
  userId             String
  provider           ProviderType
  providerAccountId  String?
  profile            String?
  refresh_token      String?  
  access_token       String?  
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  
  session_state      String?


  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])
  // make unique provider for each user
  @@unique([userId, provider]) 
  @@map("provider")
}

model UserRole{
  id            String    @id @default(uuid())
  role Roletype @default(GUEST)
  levelId String? @unique
  userId String @unique


  level Level? @relation(fields: [levelId], references: [id])
  user User @relation(fields: [userId], references: [id])
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("user-role")

}
model Level{
  id            String    @id @default(uuid())
  levelName String

  features String[]
  role UserRole[]

  @@map("permission-group")
}


model VerificationToken {
  id         String   @id @default(uuid())
  uid        String   @unique
  token      String   
  validity   Int      @default(1)
 
  user       User     @relation(fields: [uid], references: [id])
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  @@map("verification-token")
}